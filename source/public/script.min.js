function init_dv(){update_dv(),document.getElementById("add-key").addEventListener("click",()=>{progress_dv(1),fetch("/api/key",{method:"POST"}).then(function(t){update_dv()}).catch(function(t){console.log(t)})})}function timer_dv(){update_dv()}function update_dv(){const t=document.getElementById("output_tbl");let a="";fetch("/api/key",{method:"GET"}).then(t=>t.json()).then(t=>get_req=t).then(()=>{console.log(get_req),get_req.forEach((t,e)=>{a+=`<tr>
                        <th scope="col" class="d-none d-xl-table-cell text-center api-key">
                            <div class="form-outline"> <input class="form-control active" type="text" value="`+t.key+`"
                                    aria-label="readonly api key" readonly="" disabled>
                                <div style="position:absolute; left:0; right:0; top:0; bottom:0;"></div> <label class="form-label"
                                    style="margin-left: 0px;">Readonly</label>
                                <div class="form-notch">
                                    <div class="form-notch-leading" style="width: 9px;"></div>
                                    <div class="form-notch-middle" style="width: 55px;"></div>
                                    <div class="form-notch-trailing"></div>
                                </div>
                            </div>
                        </th>
                        <th scope="col">
                            <div class="input-group align-items-center justify-content-center flex-nowrap">
                                <div class="form-outline float-start"> <input type="text" class="form-control input-name placeholder-active"
                                        value="`+t.name+`">
                                    <div class="form-notch">
                                        <div class="form-notch-leading" style="width: 9px;"></div>
                                        <div class="form-notch-middle" style="width: 0px;"></div>
                                        <div class="form-notch-trailing"></div>
                                    </div>
                                </div> <button type="button" class="btn btn-outline-dark d-table-cell d-xl-none copy-key"> <i
                                        class="fas fa-copy"></i> </button> <button type="button"
                                    class="btn btn-outline-dark d-table-cell d-xl-none del-key"> <i class="fas fa-trash"></i> </button>
                            </div>
                        </th>
                        <th class="d-none d-xl-table-cell"> <button type="button" class="btn btn-outline-dark copy-key"> <i
                                    class="fas fa-copy"></i> </button> <button type="button" class="btn btn-outline-dark del-key"> <i
                                    class="fas fa-trash"></i> </button> </th>
                    </tr>`}),t.innerHTML=a,listeners_dv(),progress_dv(0)}).catch(function(t){console.log(t)})}function index_calc_dv(t){return t%2!=0?t=t/2-.5:t/=2,t}function listeners_dv(){document.querySelectorAll(".api-key > div").forEach((t,e)=>{api_key=document.querySelectorAll(".api-key input")[index_calc_dv(e)].value.trim(),t.addEventListener("click",t=>{navigator.clipboard.writeText(api_key),Swal.fire({title:"API key kopiert:",text:api_key.substr(0,40)+"...",icon:"success",customClass:{confirmButton:"btn btn-outline-dark m-2"},buttonsStyling:!1})})}),document.querySelectorAll(".input-name").forEach((t,e)=>{t.addEventListener("blur",t=>{progress_dv(1),input_name=document.querySelectorAll(".input-name")[e].value,fetch("/api/key?id="+e+"&value="+input_name,{method:"PATCH"}).then(function(t){progress_dv(0)})})}),document.querySelectorAll(".del-key").forEach((t,e)=>{t.addEventListener("click",t=>{Swal.fire({title:"Sind Sie sich sicher?",text:"Sie können dies nicht rückgängig machen!",icon:"warning",showCancelButton:!0,customClass:{confirmButton:"btn btn-danger m-2",cancelButton:"btn btn-outline-dark m-2"},buttonsStyling:!1,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:"Abbrechen",confirmButtonText:"Löschen"}).then(t=>{t.isConfirmed&&(progress_dv(1),fetch("/api/key?id="+index_calc_dv(e),{method:"DELETE"}).then(function(t){update_dv()}).catch(function(t){console.log(t)}))})})}),document.querySelectorAll(".copy-key").forEach((t,e)=>{t.addEventListener("click",t=>{api_key=document.querySelectorAll(".api-key input")[index_calc_dv(e)].value.trim(),navigator.clipboard.writeText(api_key),Swal.fire({title:"API key kopiert:",text:api_key.substr(0,40)+"...",icon:"success",customClass:{confirmButton:"btn btn-outline-dark m-2"},buttonsStyling:!1})})})}function progress_dv(t){document.getElementById("loading");1==t?(click_block.open(),loading_animation.on()):(click_block.close(),loading_animation.off())}function update_fi(){const t=document.getElementById("accordionFiles");let a="";fetch("/api/tours",{method:"GET"}).then(t=>t.json()).then(t=>get_req=t).then(()=>{console.log(get_req),get_req.forEach((t,e)=>{a+=`<div class="accordion-item">
                        <h2 class="accordion-header d-flex justify-content-center align-items-center" id="heading_`+e+`">

                            <button type="button" class="btn btn-dark ms-3 p-1 rn-name-btn"
                                style="min-width: 30px; max-height: 30px;">
                                <i class="fas fa-pen"></i>
                            </button>
                            <button class="accordion-button collapsed flex-grow-1 accordion-btn text-dark" type="button" data-mdb-toggle="collapse"
                                data-mdb-target="#collapse_`+e+'" aria-expanded="false" aria-controls="collapse_'+e+`"
                                style="box-shadow: none;">
                                `+t.name+" <span class='ms-4 font-monospace text-black-50'>["+t.file+"]</span> "+`
                            </button>

                        </h2>
                        <div id="collapse_`+e+'" class="accordion-collapse collapse" aria-labelledby="heading_'+e+`"
                            data-mdb-parent="#accordionFiles">
                            <div class="accordion-body pt-1">

                                <div class="container-fluid">
                                    <div class="row">

                                        <div class="col-3">
                                            <div class="card">
                                                <div class="card-body p-3">
                                                    <h5 class="card-title text-center">°C</h5>
                                                    <div class="container-fluid m-0 p-0">
                                                        <div class="row">
                                                            <div class="col text-end p-0 px-1">
                                                                Max: <br>
                                                                Min: <br>
                                                                Avg: <br>
                                                            </div>
                                                            <div class="col p-0 px-1 temp_info">
                                                                <span class="badge bg-dark rounded-pill">-</span> <br>
                                                                <span class="badge bg-dark rounded-pill">-</span> <br>
                                                                <span class="badge bg-dark rounded-pill">-</span> <br>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-3">
                                            <div class="card">
                                                <div class="card-body p-3">
                                                    <h5 class="card-title text-center">Km/h</h5>
                                                    <div class="container-fluid m-0 p-0">
                                                        <div class="row">
                                                            <div class="col text-end p-0 px-1">
                                                                Max: <br>
                                                                Min: <br>
                                                                Avg: <br>
                                                            </div>
                                                            <div class="col p-0 px-1 speed_info">
                                                                <span class="badge bg-dark rounded-pill">-</span> <br>
                                                                <span class="badge bg-dark rounded-pill">-</span> <br>
                                                                <span class="badge bg-dark rounded-pill">-</span> <br>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-1"> </div>

                                        <div class="col-4">
                                            <div class="form-outline">
                                                <textarea class="form-control active shadow-3" id="textArea_`+e+`" rows="5"
                                                    style="resize: none;"> `+t.notes+` </textarea>
                                                <label class="form-label" for="textArea_`+e+`"
                                                    style="margin-left: 0px;">Notizen</label>
                                                <div class="form-notch">
                                                    <div class="form-notch-leading" style="width: 9px;"></div>
                                                    <div class="form-notch-middle" style="width: 52px;"></div>
                                                    <div class="form-notch-trailing"></div>
                                                </div>
                                            </div>
                                        </div>


                                        <div class="col-1">
                                            <button type="button" class="btn btn-dark mb-2 p-0 open-element-btn"
                                                style="min-width: 30px; min-height: 40px;">
                                                <i class="fas fa-external-link-alt"></i>
                                            </button>
                                            <button type="button" class="btn btn-dark mb-2 p-0 del-element-btn"
                                                style="min-width: 30px; min-height: 40px;">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                            <button type="button" class="btn btn-dark mb-2 p-0 download-element-btn"
                                                style="min-width: 30px; min-height: 40px;">
                                                <i class="fas fa-download"></i>
                                            </button>
                                        </div>

                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>`}),t.innerHTML=a,listeners_fi(get_req)}).catch(function(t){console.log(t)})}function listeners_fi(o){console.log("ev li"),console.log(o),document.querySelectorAll(".rn-name-btn").forEach((t,e)=>{t.addEventListener("click",t=>{document.querySelectorAll(".accordion-btn").forEach(t=>{t.classList.contains("collapsed")||t.click()}),Swal.fire({title:"Namensänderung",input:"text",inputLabel:"Bitte geben sie ihren gewünschten Namen ein.",showCancelButton:!0,customClass:{confirmButton:"btn btn-danger m-2",cancelButton:"btn btn-outline-dark m-2"},buttonsStyling:!1,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:"Abbrechen",confirmButtonText:"Ändern",inputValidator:t=>{if(!t)return"Name kann nicht leer sein!"}}).then(t=>{t.isConfirmed&&console.log(t.value)})})}),document.querySelectorAll(".accordion-btn").forEach((t,e)=>{const a=document.querySelectorAll(".speed_info")[e].querySelectorAll("span"),n=document.querySelectorAll(".temp_info")[e].querySelectorAll("span");t.addEventListener("click",t=>{"-"==a[0].innerHTML&&(loading_animation.on(),fetch("/api/tours/info?file="+o[e].file,{method:"GET"}).then(t=>t.json()).then(t=>get_req=t).then(function(t){console.log("api req"),a.forEach((t,e)=>{t.innerHTML=get_req[e]}),n.forEach((t,e)=>{t.innerHTML=get_req[e+3]}),loading_animation.off()}))})}),document.querySelectorAll(".open-element-btn").forEach((t,e)=>{t.addEventListener("click",t=>{console.log("open at: "+e),window.open("/view/"+o[e].file,"_blank")})}),document.querySelectorAll(".del-element-btn").forEach((t,e)=>{t.addEventListener("click",t=>{console.log("delete at: "+e)})}),document.querySelectorAll(".download-element-btn").forEach((t,e)=>{t.addEventListener("click",t=>{console.log("download at: "+e)})})}-1!=window.location.href.indexOf("/devices")&&(init_dv(),setInterval(()=>{timer_dv()},3e4)),-1!=window.location.href.indexOf("/files")&&update_fi();const click_block={container:null,body:null,cssClass:"click_block",check:function(){null==this.body&&(this.body=document.getElementsByTagName("body")[0])},open:function(){return this.check(),this.isOpen()||(this.container=document.createElement("div"),this.container.setAttribute("id","click_block"),this.body.append(this.container),this.body.classList.add(this.cssClass)),this},close:function(){return this.check(),this.isOpen()&&(this.body.classList.remove(this.cssClass),this.container.remove()),this},isOpen:function(){return this.check(),this.body.classList.contains(this.cssClass)}},loading_animation={container:document.getElementById("loading"),on:function(){this.container.style.opacity="1"},off:function(){this.container.style.opacity="0"}};function initMap(){const t=chroma.scale(["blue","yellow","red"]);var e=new google.maps.Map(document.getElementById("map"),{zoom:18,center:new google.maps.LatLng(data_array[1][8],data_array[1][9]),mapTypeId:"terrain"});let a=0;for(i=1;i<data_array.length-2;i++)a<data_array[i][11]&&(a=data_array[i][11]);for(i=1;i<data_array.length-2;i++){var n=new google.maps.LatLng(data_array[i][8],data_array[i][9]),o=new google.maps.LatLng(data_array[i+1][8],data_array[i+1][9]),l=data_array[i][11];polyline=new google.maps.Polyline({path:[n,o],geodesic:!0,strokeColor:t(l/a).toString(),strokeOpacity:1,strokeWeight:2,map:e})}var d=document.getElementById("infoChart").getContext("2d");const s=new Chart(d,{type:"line",responsive:!0,data:{labels:[],datasets:[{label:"km/h",data:[],borderWidth:1,borderColor:["#58508d"],pointStyle:"line"},{label:"C",data:[],borderWidth:1,borderColor:["#ff6361"],pointStyle:"line"},{label:"H",data:[],borderWidth:1,borderColor:["#ffa600"],pointStyle:"line"}]},options:{scales:{y:{beginAtZero:!0,suggestedMax:50}},elements:{point:{radius:0}}}});d=document.getElementById("accChart").getContext("2d");const r=new Chart(d,{type:"line",responsive:!0,data:{labels:[],datasets:[{label:"x",data:[],borderWidth:1,borderColor:["#003f5c"],pointStyle:"line"},{label:"y",data:[],borderWidth:1,borderColor:["#58508d"],pointStyle:"line"},{label:"z",data:[],borderWidth:1,borderColor:["#bc5090"],pointStyle:"line"}]},options:{scales:{y:{beginAtZero:!0}},elements:{point:{radius:0}}}});d=document.getElementById("rotChart").getContext("2d");const c=new Chart(d,{type:"line",responsive:!0,data:{labels:[],datasets:[{label:"x",data:[],borderWidth:1,borderColor:["#003f5c"],pointStyle:"line"},{label:"y",data:[],borderWidth:1,borderColor:["#58508d"],pointStyle:"line"},{label:"z",data:[],borderWidth:1,borderColor:["#bc5090"],pointStyle:"line"}]},options:{scales:{y:{beginAtZero:!0}},elements:{point:{radius:0}}}});for(let t=1;t<data_array.length-2;t++)s.data.labels[t]=data_array[t][7].substring(0,5),s.data.datasets[0].data[t]=data_array[t][11],s.data.datasets[1].data[t]=data_array[t][6],s.data.datasets[2].data[t]=data_array[t][10],r.data.labels[t]=data_array[t][7].substring(0,5),r.data.datasets[0].data[t]=data_array[t][0],r.data.datasets[1].data[t]=data_array[t][1],r.data.datasets[2].data[t]=data_array[t][2],c.data.labels[t]=data_array[t][7].substring(0,5),c.data.datasets[0].data[t]=data_array[t][3],c.data.datasets[1].data[t]=data_array[t][4],c.data.datasets[2].data[t]=data_array[t][5];s.update(),r.update(),c.update()}