function init_dv(){update_dv(),document.getElementById("add-key").addEventListener("click",()=>{progress(1),fetch("/api/key",{method:"POST"}).then(function(t){update_dv()}).catch(function(t){console.log(t)})})}function timer_dv(){update_dv()}function update_dv(){const t=document.getElementById("output_tbl");let a="";fetch("/api/key",{method:"GET"}).then(t=>t.json()).then(t=>get_req=t).then(()=>{get_req.forEach((t,e)=>{a+=`<tr>
                        <th scope="col" class="d-none d-xl-table-cell text-center api-key">
                            <div class="form-outline"> <input class="form-control active" type="text" value="`+t.key+`"
                                    aria-label="readonly api key" readonly="" disabled>
                                <div style="position:absolute; left:0; right:0; top:0; bottom:0;"></div> <label class="form-label"
                                    style="margin-left: 0px;">Readonly</label>
                                <div class="form-notch">
                                    <div class="form-notch-leading" style="width: 9px;"></div>
                                    <div class="form-notch-middle" style="width: 55px;"></div>
                                    <div class="form-notch-trailing"></div>
                                </div>
                            </div>
                        </th>
                        <th scope="col">
                            <div class="input-group align-items-center justify-content-center flex-nowrap">
                                <div class="form-outline float-start"> <input type="text" class="form-control input-name placeholder-active"
                                        value="`+t.name+`">
                                    <div class="form-notch">
                                        <div class="form-notch-leading" style="width: 9px;"></div>
                                        <div class="form-notch-middle" style="width: 0px;"></div>
                                        <div class="form-notch-trailing"></div>
                                    </div>
                                </div> <button type="button" class="btn btn-outline-dark d-table-cell d-xl-none copy-key"> <i
                                        class="fas fa-copy"></i> </button> <button type="button"
                                    class="btn btn-outline-dark d-table-cell d-xl-none del-key"> <i class="fas fa-trash"></i> </button>
                            </div>
                        </th>
                        <th class="d-none d-xl-table-cell"> <button type="button" class="btn btn-outline-dark copy-key"> <i
                                    class="fas fa-copy"></i> </button> <button type="button" class="btn btn-outline-dark del-key"> <i
                                    class="fas fa-trash"></i> </button> </th>
                    </tr>`}),t.innerHTML=a,listeners_dv(),progress(0)}).catch(function(t){console.log(t)})}function index_calc_dv(t){return t%2!=0?t=t/2-.5:t/=2,t}function listeners_dv(){document.querySelectorAll(".api-key > div").forEach((t,e)=>{api_key=document.querySelectorAll(".api-key input")[index_calc_dv(e)].value.trim(),t.addEventListener("click",t=>{navigator.clipboard.writeText(api_key),Swal.fire({title:"API key kopiert:",text:api_key.substr(0,40)+"...",icon:"success",customClass:{confirmButton:"btn btn-outline-dark m-2"},buttonsStyling:!1})})}),document.querySelectorAll(".input-name").forEach((t,e)=>{t.addEventListener("blur",t=>{progress(1),input_name=document.querySelectorAll(".input-name")[e].value,fetch("/api/key?id="+e+"&value="+input_name,{method:"PATCH"}).then(function(t){progress(0)})})}),document.querySelectorAll(".del-key").forEach((t,e)=>{t.addEventListener("click",t=>{Swal.fire({title:"Sind Sie sich sicher?",text:"Sie können dies nicht rückgängig machen!",icon:"warning",showCancelButton:!0,customClass:{confirmButton:"btn btn-danger m-2",cancelButton:"btn btn-outline-dark m-2"},buttonsStyling:!1,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:"Abbrechen",confirmButtonText:"Löschen"}).then(t=>{t.isConfirmed&&(progress(1),fetch("/api/key?id="+index_calc_dv(e),{method:"DELETE"}).then(function(t){update_dv()}).catch(function(t){console.log(t)}))})})}),document.querySelectorAll(".copy-key").forEach((t,e)=>{t.addEventListener("click",t=>{api_key=document.querySelectorAll(".api-key input")[index_calc_dv(e)].value.trim(),navigator.clipboard.writeText(api_key),Swal.fire({title:"API key kopiert:",text:api_key.substr(0,40)+"...",icon:"success",customClass:{confirmButton:"btn btn-outline-dark m-2"},buttonsStyling:!1})})})}function update_fi(){const t=document.getElementById("accordionFiles");let a="";fetch("/api/tours",{method:"GET"}).then(t=>t.json()).then(t=>get_req=t).then(()=>{get_req.forEach((t,e)=>{a+=`<div class="accordion-item">
                        <h2 class="accordion-header d-flex justify-content-center align-items-center" id="heading_`+e+`">

                            <button type="button" class="btn btn-dark ms-3 p-1 rn-name-btn"
                                style="min-width: 25px; min-height: 25px;">
                                <i class="fas fa-pen"></i>
                            </button>
                            <button class="accordion-button collapsed flex-grow-1 accordion-btn text-dark" type="button" data-mdb-toggle="collapse"
                                data-mdb-target="#collapse_`+e+'" aria-expanded="false" aria-controls="collapse_'+e+`"
                                style="box-shadow: none;">
                                `+t.name+" <span class='ms-4 font-monospace text-black-50 d-none d-md-inline'>["+t.file+"]</span> "+`
                            </button>

                        </h2>
                        <div id="collapse_`+e+'" class="accordion-collapse collapse" aria-labelledby="heading_'+e+`"
                            data-mdb-parent="#accordionFiles">
                            <div class="accordion-body pt-1">

                                <div class="container-fluid">
                                    <div class="row">

                                        <div class="col-md-3 col-6 pb-4 pb-md-0">
                                            <div class="card">
                                                <div class="card-body p-3">
                                                    <h5 class="card-title text-center">°C</h5>
                                                    <div class="container-fluid m-0 p-0">
                                                        <div class="row">
                                                            <div class="col text-end p-0 px-1">
                                                                Max: <br>
                                                                Min: <br>
                                                                Avg: <br>
                                                            </div>
                                                            <div class="col p-0 px-1 temp_info">
                                                                <span class="badge bg-dark rounded-pill">-</span> <br>
                                                                <span class="badge bg-dark rounded-pill">-</span> <br>
                                                                <span class="badge bg-dark rounded-pill">-</span> <br>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-md-3 col-6 pb-4 pb-md-0">
                                            <div class="card">
                                                <div class="card-body p-3">
                                                    <h5 class="card-title text-center">Km/h</h5>
                                                    <div class="container-fluid m-0 p-0">
                                                        <div class="row">
                                                            <div class="col text-end p-0 px-1">
                                                                Max: <br>
                                                                Min: <br>
                                                                Avg: <br>
                                                            </div>
                                                            <div class="col p-0 px-1 speed_info">
                                                                <span class="badge bg-dark rounded-pill">-</span> <br>
                                                                <span class="badge bg-dark rounded-pill">-</span> <br>
                                                                <span class="badge bg-dark rounded-pill">-</span> <br>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-md-1"> </div>

                                        <div class="col-md-4 pb-4 pb-md-0">
                                            <div class="form-outline">
                                                <textarea class="form-control textarea-notes active shadow-3" id="textArea_`+e+`" rows="5"
                                                maxlength="100" style="resize: none;">`+t.notes+`</textarea>
                                                <label class="form-label" for="textArea_`+e+`"
                                                    style="margin-left: 0px;">Notizen</label>
                                                <div class="form-notch">
                                                    <div class="form-notch-leading" style="width: 9px;"></div>
                                                    <div class="form-notch-middle" style="width: 52px;"></div>
                                                    <div class="form-notch-trailing"></div>
                                                </div>
                                            </div>
                                        </div>


                                        <div class="col-md-1">
                                            <button type="button" class="btn btn-dark mb-2 p-0 open-element-btn float-md-none float-end ms-2 ms-md-0"
                                                style="min-width: 30px; min-height: 40px;">
                                                <i class="fas fa-external-link-alt"></i>
                                            </button>
                                            <button type="button" class="btn btn-dark mb-2 p-0 del-element-btn float-md-none float-end ms-2 ms-md-0"
                                                style="min-width: 30px; min-height: 40px;">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                            <button disabled type="button" class="btn btn-dark mb-2 p-0 download-element-btn float-md-none float-end ms-2 ms-md-0"
                                                style="min-width: 30px; min-height: 40px;">
                                                <i class="fas fa-download"></i>
                                            </button>
                                        </div>

                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>`}),t.innerHTML=a,listeners_fi(get_req),progress(0)}).catch(function(t){console.log(t)})}function listeners_fi(o){document.querySelectorAll(".rn-name-btn").forEach((t,e)=>{t.addEventListener("click",t=>{document.querySelectorAll(".accordion-btn").forEach(t=>{t.classList.contains("collapsed")||t.click()}),Swal.fire({title:"Namensänderung",input:"text",inputLabel:"Bitte geben sie ihren gewünschten Namen ein.",showCancelButton:!0,customClass:{confirmButton:"btn btn-danger m-2",cancelButton:"btn btn-outline-dark m-2"},buttonsStyling:!1,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:"Abbrechen",confirmButtonText:"Ändern",inputValidator:t=>{if(!t)return"Name kann nicht leer sein!"}}).then(t=>{t.isConfirmed&&(progress(1),fetch("/api/tours?id="+e+"&name="+t.value,{method:"PATCH"}).then(function(t){update_fi()}).catch(function(t){console.log(t)}))})})}),document.querySelectorAll(".accordion-btn").forEach((t,e)=>{const a=document.querySelectorAll(".speed_info")[e].querySelectorAll("span"),n=document.querySelectorAll(".temp_info")[e].querySelectorAll("span");t.addEventListener("click",t=>{"-"==a[0].innerHTML&&(loading_animation.on(),fetch("/api/tours?file="+o[e].file,{method:"GET"}).then(t=>t.json()).then(t=>get_req=t).then(function(t){a.forEach((t,e)=>{t.innerHTML=get_req[e]}),n.forEach((t,e)=>{t.innerHTML=get_req[e+3]}),loading_animation.off()}))})}),document.querySelectorAll(".open-element-btn").forEach((t,e)=>{t.addEventListener("click",t=>{window.open("/view/"+o[e].file,"_blank")})}),document.querySelectorAll(".del-element-btn").forEach((t,e)=>{t.addEventListener("click",t=>{Swal.fire({title:"Sind Sie sich sicher?",text:"Sie können dies nicht rückgängig machen!",icon:"warning",showCancelButton:!0,customClass:{confirmButton:"btn btn-danger m-2",cancelButton:"btn btn-outline-dark m-2"},buttonsStyling:!1,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:"Abbrechen",confirmButtonText:"Löschen"}).then(t=>{t.isConfirmed&&(progress(1),fetch("/api/tours?id="+e,{method:"DELETE"}).then(function(t){update_fi()}).catch(function(t){console.log(t)}))})})}),document.querySelectorAll(".textarea-notes").forEach((e,a)=>{e.addEventListener("blur",t=>{fetch("/api/tours?id="+a+"&notes="+e.value.replace(/\n/g,"%0A"),{method:"PATCH"}).then(function(t){}).catch(function(t){console.log(t)})})}),document.querySelectorAll(".download-element-btn").forEach((t,e)=>{t.addEventListener("click",t=>{console.log("download at: "+e)})})}-1!=window.location.href.indexOf("/devices")&&(init_dv(),setInterval(()=>{timer_dv()},3e4)),-1!=window.location.href.indexOf("/files")&&update_fi();const click_block={container:null,body:null,cssClass:"click_block",check:function(){null==this.body&&(this.body=document.getElementsByTagName("body")[0])},open:function(){return this.check(),this.isOpen()||(this.container=document.createElement("div"),this.container.setAttribute("id","click_block"),this.body.append(this.container),this.body.classList.add(this.cssClass)),this},close:function(){return this.check(),this.isOpen()&&(this.body.classList.remove(this.cssClass),this.container.remove()),this},isOpen:function(){return this.check(),this.body.classList.contains(this.cssClass)}},loading_animation={container:document.getElementById("loading"),on:function(){this.container.style.opacity="1"},off:function(){this.container.style.opacity="0"}};function progress(t){1==t?(click_block.open(),loading_animation.on()):(click_block.close(),loading_animation.off())}function initMap(){var t="#2f4b7c",e="#d45087",a="#ff7c43";const n=chroma.scale(["blue","yellow","red"]);var o=new google.maps.Map(document.getElementById("map"),{zoom:18,center:new google.maps.LatLng(data_array[1][8],data_array[1][9]),mapTypeId:"terrain"});let l=0;for(i=1;i<data_array.length-2;i++)l<data_array[i][11]&&(l=data_array[i][11]);for(i=1;i<data_array.length-2;i++){var s=new google.maps.LatLng(data_array[i][8],data_array[i][9]),d=new google.maps.LatLng(data_array[i+1][8],data_array[i+1][9]),r=data_array[i][11];polyline=new google.maps.Polyline({path:[s,d],geodesic:!0,strokeColor:n(r/l).toString(),strokeOpacity:1,strokeWeight:2,map:o})}var c=document.getElementById("infoChart").getContext("2d");const p=new Chart(c,{type:"line",responsive:!0,data:{labels:[],datasets:[{label:"km/h",data:[],borderWidth:1,borderColor:["#58508d"],pointStyle:"line"},{label:"C",data:[],borderWidth:1,borderColor:["#ff6361"],pointStyle:"line"},{label:"H",data:[],borderWidth:1,borderColor:["#ffa600"],pointStyle:"line"}]},options:{scales:{y:{beginAtZero:!0,suggestedMax:50}},elements:{point:{radius:0}}}});c=document.getElementById("accChart").getContext("2d");const b=new Chart(c,{type:"line",responsive:!0,data:{labels:[],datasets:[{label:"x",data:[],borderWidth:1,borderColor:["#003f5c"],pointStyle:"line"},{label:"y",data:[],borderWidth:1,borderColor:["#58508d"],pointStyle:"line"},{label:"z",data:[],borderWidth:1,borderColor:["#bc5090"],pointStyle:"line"}]},options:{scales:{y:{beginAtZero:!0}},elements:{point:{radius:0}}}});c=document.getElementById("rotChart").getContext("2d");const u=new Chart(c,{type:"line",responsive:!0,data:{labels:[],datasets:[{label:"x",data:[],borderWidth:1,borderColor:["#003f5c"],pointStyle:"line"},{label:"y",data:[],borderWidth:1,borderColor:["#58508d"],pointStyle:"line"},{label:"z",data:[],borderWidth:1,borderColor:["#bc5090"],pointStyle:"line"}]},options:{scales:{y:{beginAtZero:!0}},elements:{point:{radius:0}}}}),m=new Chart(document.getElementById("setChart").getContext("2d"),{type:"line",responsive:!0,maintainAspectRatio:!1,data:{labels:[],datasets:[{label:"Geschwindigkeit",data:[],borderWidth:1,borderColor:["#f95d6a"],pointStyle:"line"}]},options:{maintainAspectRatio:!1,scales:{y:{beginAtZero:!0}},elements:{point:{radius:0}}}}),h=new Chart(document.getElementById("rxChart").getContext("2d"),{type:"line",responsive:!0,maintainAspectRatio:!1,data:{labels:[],datasets:[{label:"Rotation X",data:[],borderWidth:1,borderColor:[t],pointStyle:"line"}]},options:{maintainAspectRatio:!1,scales:{y:{beginAtZero:!0}},elements:{point:{radius:0}}}}),y=new Chart(document.getElementById("ryChart").getContext("2d"),{type:"line",responsive:!0,maintainAspectRatio:!1,data:{labels:[],datasets:[{label:"Rotation Y",data:[],borderWidth:1,borderColor:[e],pointStyle:"line"}]},options:{maintainAspectRatio:!1,scales:{y:{beginAtZero:!0}},elements:{point:{radius:0}}}}),f=new Chart(document.getElementById("rzChart").getContext("2d"),{type:"line",responsive:!0,maintainAspectRatio:!1,data:{labels:[],datasets:[{label:"Rotation Z",data:[],borderWidth:1,borderColor:[a],pointStyle:"line"}]},options:{maintainAspectRatio:!1,scales:{y:{beginAtZero:!0}},elements:{point:{radius:0}}}}),g=new Chart(document.getElementById("fxChart").getContext("2d"),{type:"line",responsive:!0,maintainAspectRatio:!1,data:{labels:[],datasets:[{label:"Achse X",data:[],borderWidth:1,borderColor:[t],pointStyle:"line"}]},options:{maintainAspectRatio:!1,scales:{y:{beginAtZero:!0}},elements:{point:{radius:0}}}}),v=new Chart(document.getElementById("fyChart").getContext("2d"),{type:"line",responsive:!0,maintainAspectRatio:!1,data:{labels:[],datasets:[{label:"Achse Y",data:[],borderWidth:1,borderColor:[e],pointStyle:"line"}]},options:{maintainAspectRatio:!1,scales:{y:{beginAtZero:!0}},elements:{point:{radius:0}}}}),x=new Chart(document.getElementById("fzChart").getContext("2d"),{type:"line",responsive:!0,maintainAspectRatio:!1,data:{labels:[],datasets:[{label:"Achse Z",data:[],borderWidth:1,borderColor:[a],pointStyle:"line"}]},options:{maintainAspectRatio:!1,scales:{y:{beginAtZero:!0}},elements:{point:{radius:0}}}});for(let t=1;t<data_array.length-2;t++)m.data.labels[t]=data_array[t][7].substring(0,5),m.data.datasets[0].data[t]=data_array[t][11],p.data.labels[t]=data_array[t][7].substring(0,5),p.data.datasets[0].data[t]=data_array[t][11],p.data.datasets[1].data[t]=data_array[t][6],p.data.datasets[2].data[t]=data_array[t][10],b.data.labels[t]=data_array[t][7].substring(0,5),b.data.datasets[0].data[t]=data_array[t][0],b.data.datasets[1].data[t]=data_array[t][1],b.data.datasets[2].data[t]=data_array[t][2],u.data.labels[t]=data_array[t][7].substring(0,5),u.data.datasets[0].data[t]=data_array[t][3],u.data.datasets[1].data[t]=data_array[t][4],u.data.datasets[2].data[t]=data_array[t][5];m.update(),p.update(),b.update(),u.update(),document.querySelectorAll(".lb-open").forEach((t,e)=>{const a=document.querySelectorAll(".lb-container")[e],n=document.querySelectorAll(".lb-close")[e],o=document.querySelectorAll('[data-mdb-toggle="tooltip"]');t.addEventListener("click",t=>{a.style.visibility="visible",a.style.opacity="1",o.forEach(t=>{const e=mdb.Tooltip.getInstance(t);e.hide()})}),n.addEventListener("click",t=>{a.style.visibility="hidden",a.style.opacity="0"})}),document.addEventListener("keydown",function(t){"Escape"===t.key&&document.querySelectorAll(".lb-container").forEach((t,e)=>{t.style.visibility="hidden",t.style.opacity="0"})});var _=document.getElementById("setChart"),c=document.getElementById("overlay"),k=m,C=(console.log(c),0),A=(c.width=_.width,c.height=_.height,c.getContext("2d")),w={w:0,startX:0,startY:0},E=!1;console.log(_),_.addEventListener("pointerdown",t=>{var e=k.getElementsAtEventForMode(t,"index",{intersect:!1}),e=(console.log(e[0].index),C=e[0].index,_.getBoundingClientRect());w.startX=t.clientX-e.left,w.startY=k.chartArea.top,E=!0}),_.addEventListener("pointermove",t=>{const e=_.getBoundingClientRect();if(E){const e=_.getBoundingClientRect();w.w=t.clientX-e.left-w.startX,A.globalAlpha=.5,A.clearRect(0,0,_.width,_.height),A.fillRect(w.startX,w.startY,w.w,k.chartArea.bottom-k.chartArea.top)}else{A.clearRect(0,0,_.width,_.height);t=t.clientX-e.left;t>k.chartArea.left&&A.fillRect(t,k.chartArea.top,1,k.chartArea.bottom-k.chartArea.top)}}),_.addEventListener("pointerup",t=>{var t=k.getElementsAtEventForMode(t,"index",{intersect:!1}),e=(E=!1,console.log("implement filter between "+m.data.labels[C]+" and "+m.data.labels[t[0].index]),C),a=t[0].index;a<e&&(t=e,e=a,a=t),h.options.scales.x.min=e,h.options.scales.x.max=a,y.options.scales.x.min=e,y.options.scales.x.max=a,f.options.scales.x.min=e,f.options.scales.x.max=a,g.options.scales.x.min=e,g.options.scales.x.max=a,v.options.scales.x.min=e,v.options.scales.x.max=a,x.options.scales.x.min=e,x.options.scales.x.max=a;for(let t=1;t<data_array.length-2;t++)h.data.datasets[0].data.pop(),h.data.labels.pop(),y.data.datasets[0].data.pop(),y.data.labels.pop(),f.data.datasets[0].data.pop(),f.data.labels.pop(),g.data.datasets[0].data.pop(),g.data.labels.pop(),v.data.datasets[0].data.pop(),v.data.labels.pop(),x.data.datasets[0].data.pop(),x.data.labels.pop();for(let t=e;t<a;t++)h.data.labels[t]=data_array[t][7].substring(0,5),h.data.datasets[0].data[t]=data_array[t][3],y.data.labels[t]=data_array[t][7].substring(0,5),y.data.datasets[0].data[t]=data_array[t][4],f.data.labels[t]=data_array[t][7].substring(0,5),f.data.datasets[0].data[t]=data_array[t][5],g.data.labels[t]=data_array[t][7].substring(0,5),g.data.datasets[0].data[t]=data_array[t][0],v.data.labels[t]=data_array[t][7].substring(0,5),v.data.datasets[0].data[t]=data_array[t][1],x.data.labels[t]=data_array[t][7].substring(0,5),x.data.datasets[0].data[t]=data_array[t][2];h.update("none"),y.update("none"),f.update("none"),g.update("none"),v.update("none"),x.update("none")})}